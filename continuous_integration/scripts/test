#!/usr/bin/env bash

test_ci() {
    set -xeou pipefail

    activate_conda_env;

    cd "${BINDINGS_ARTIFACTS_DIR}"
    pip install *.whl

    cd "${CORE_ARTIFACTS_DIR}"
    pip install *.whl

    cd "${REPO_DIR}/cuda_core"
    python -m pytest tests/

    cd "${REPO_DIR}/cuda_bindings"
    python -m pytest tests/

}

test_project() {
    set -xeou pipefail

    export PYTHONUNBUFFERED=1

    . setup-utils;
    init_test_env "$@";

    git config --global --add safe.directory "$REPO_DIR/.git"

    case "${TEST_TYPE}" in
        ci) test_ci;;
        *) return 1;;
    esac
}

(test_project "$@");
